# 5 Mysql SQL基础

## 5.1 常用数据类型

### 5.1.1 整型

|  类型   | 字节  |      范围(有符号位)       |
| :-----: | :---: | :-----------------------: |
| TINYINT | 1Byte |  0~2^8 OR  -2^7 ~ 2^7-1   |
|   INT   | 4Byte | 0~2^32 OR  -2^31 ~ 2^31-1 |
| BIGINT  | 8Byte | 0~2^64 OR -2^63 ~ 2^63-1  |

- int(M)  M表示总位数
  - 如果某个数不够定义字段时设置的位数，则前面以0补填，zerofill 属性修改
  - 例：int(5)   插入一个数'123'，补填后为'00123'
- 默认存在符号位，unsigned 属性修改
- 在满足要求的情况下，越小越好
- 1表示bool值真，0表示bool值假。MySQL没有布尔类型，通过整型0和1表示。常用tinyint(1)表示布尔型

### 5.1.2 小数

|      类型      |  字节  |   范围(有符号位)    |
| :------------: | :----: | :-----------------: |
| float(单精度)  | 4Byte  | 自定义，表示近似值  |
| double(双精度) | 8Byte  | 自定义，表示近似值  |
|    decimal     | 自定义 | 自定义,表示精确数值 |

- 浮点型既支持符号位 unsigned 属性，也支持显示宽度 zerofill 属性，不同于整型，前后均会补填0
- 支持科学计数法表示。

- 定义浮点型时，需指定总位数和小数位数。

  > float(M, D)     double(M, D)
  >
  > M表示总位数，D表示小数位数
  >
  > M和D的大小会决定浮点数的范围 不同于整型的固定范围
  >
  > M既表示总位数（不包括小数点和正负号），也表示显示宽度（所有显示符号均包括）
  >
  > decimal(M, D)   M也表示总位数，D表示小数位数
  >
  > 保存一个精确的数值，不会发生数据的改变，不同于浮点数的四舍五入
  > 将浮点数转换为字符串来保存，每9位数字保存为4个字节

### 5.1.3 字符

|  类型   | 说明                                                         |
| :-----: | :----------------------------------------------------------- |
|  CHAR   | 定长字符串最多255个字符                                      |
| VARCHAR | 变长字符串最多65535个字符                                    |
|  TEXT   | 变长字符串最多65535个字符类型，在定义时,不需要定义长度<br/>也不会计算总长度不可给default值 |
|  BLOB   | 二进制字符串（字节字符串）                                   |
|  ENUM   | 枚举类型 smallint 存储                                       |
|   SET   | 集合类型 bigint存储                                          |

```
char(11) ：
定长字符串类型,在存储字符串时，最大字符长度11个，立即分配11个字符长度的存储空间，如果存不满，空格填充
varchar(11):
变长的字符串类型看，最大字符长度11个。在存储字符串时，自动判断字符长度，按需分配存储空间。
M表示能存储的最大长度，此长度是字符数，非字节数。
不同的编码，所占用的空间不同。
char,最多255个字符，与编码无关。
varchar,最多65535字符，与编码有关。
一条有效记录最大不能超过65535个字节。
utf8 最大为21844个字符，gbk 最大为32766个字符，latin1 最大为65532个字符
【注】varchar 是变长的，需要利用存储空间保存 varchar 的长度，如果数据小于255个字节，则采用一个字节来保存长度，反之需要两个字节来保存。
varchar 的最大有效长度由最大行大小和使用的字符集确定。

最大有效长度是65532字节，因为在varchar存字符串时，第一个字节是空的，不存在任何数据，然后还需两个字节来存放字符串的长度，所以有效长度是64432-1-2=65532字节。

例：若一个表定义为 CREATE TABLE tb(c1 int, c2 char(30), c3 varchar(N)) charset=utf8; 问N的最大值是多少？
答：(65535-1-2-4-30*3)/3

```

```
枚举类型说明
enum(val1, val2, val3...)
在已知的值中进行单选。最大数量为65535.
枚举值在保存时，以2个字节的整型(smallint)保存。每个枚举值，按保存的位置顺序，从1开始逐一递增。
表现为字符串类型，存储却是整型。
NULL值的索引是NULL。
空字符串错误值的索引值是0
枚举类型，比较适合于将来此列的值是固定范围内的特点，可以使用enum,可以很大程度的优化我们的索引结构
```

   ```mysql
集合类型说明
set(val1, val2, val3...)
create table tab ( gender set('男', '女', '无') );
insert into tab values ('男, 女');
最多可以有64个不同的成员。以bigint存储，共8个字节。采取位运算的形式
当创建表时，SET成员值的尾部空格将自动被删除
   ```



### 5.1.4 时间

|   类型    | 字节  |    说明    |                    范围                    |
| :-------: | :---: | :--------: | :----------------------------------------: |
| datetime  | 8Byte | 日期及时间 | 1000-01-01 00:00:00 到 9999-12-31 23:59:59 |
|   date    | 3Byte |    日期    |          1000-01-01 到 9999-12-31          |
| timestamp | 4Byte |   时间戳   |   19700101000000 到 2038-01-19 03:14:07    |
|   time    | 3Byte |    时间    |          -838:59:59 到 838:59:59           |
|   year    | 1Byte |    年份    |                1901 - 2155                 |



## 5.2 列属性

###  5.2.1 PRIMARY

- 能唯一标识记录的字段，可以作为主键。
- 一个表只能有一个主键。
- 主键具有唯一性。
- 声明字段时，用 primary key 标识。
- 也可以在字段列表之后声明：create table tab ( id int, stu varchar(10), primary key (id));
- 主键字段的值不能为null。
- 主键可以由多个字段共同组成。此时需要在字段列表后声明的方法。
    例：create table tab ( id int, stu varchar(10), age int, primary key (stu, age));

### 5.2.2 UNIQUE
唯一索引,使得某字段的值也不能重复。

### 5.2.3 NULL
- null不是数据类型，是列的一个属性。
- 表示当前列是否可以为null，表示什么都没有。
- null, 允许为空。默认；not null, 不允许为空。
- insert into tab values (null, 'val'); -- 此时表示将第一个字段的值设为null, 取决于该字段是否允许为null

### 5.2.4 DEFAULT
- 当前字段的默认值。
```mysql
#表示强制使用默认值
insert into tab values (default, 'val');
#表示将当前时间的时间戳 设为默认值
create table tab ( add_time timestamp default current_timestamp )
```

### 5.2.5 AUTO_INCREMENT
- 自动增长约束
- 自动增长必须为索引（主键或unique）
- 只能存在一个字段为自动增长。
- 默认为1开始自动增长。可以通过表属性 auto_increment = x进行设置，或 alter table tbl auto_increment = x;

### 5.2.6 COMMENT
注释
例：create table tab ( id int ) comment '注释内容';
### 5.2.7 FOREIGN KEY 
外键约束 高并发下不建议使用 ERP中常用



## 5.3 表属性

### 5.3.1 engine

使用的存储引擎 建议都是用Innodb

### 5.3.2 charset

使用的字符集 这个参数也可以在列属性里设置,但是不建议这样做,整表设置相同字符集即可

常用的有:

- utf8 推荐使用** 
- utf8mb4 推荐使用***
- gbk

建议默认使用utf8mb4格式:

>MySQL在5.5.3之后增加了utf8mb4的编码，mb4即4-Byte UTF-8 Unicode Encoding，专门用来兼容四字节的unicode。utf8mb4为utf8的超集并兼容utf8，比utf8能表示更多的字符。
>
>低版本的MySQL支持的utf8编码，最大字符长度为 3 字节，如果遇到 4 字节的字符就会出现错误了。
>
>常见的四字节就是Emoji 表情（Emoji 是一种特殊的 Unicode 编码，常见于 ios 和 android 手机上），和一些不常用的汉字，以及任何新增的 Unicode 字符等等。










